<div class="orders-container">
  <h1 class="page-title">My Orders</h1>

  <div class="orders-list">
    @for (order of userOrders(); track order.id || order.createdAt; let i = $index) {
    <div class="order-card">
      <div class="order-header">
        <div class="order-info">
          <h2 class="order-id">Order {{ i + 1 }}</h2>
          <p class="order-meta">
            Placed on {{ order.createdAt }} â€¢ 
            {{ order.paymentMethod === 'cod' ? 'Cash on Delivery' : 'Credit Card' }}
          </p>
        </div>
        <div class="status-badge" [class.status-delivered]="order.status === 'shipped'"
          [class.status-pending]="order.status === 'pending'"
          [class.status-confirmed]="order.status === 'confirmed'">
          {{ order.status === 'shipped' ? 'Delivered' : (order.status === 'confirmed' ? 'Confirmed' : 'Pending') }}
        </div>
      </div>

      <div class="order-items">
        @for (item of order.items; track item.productId) {
        <div class="order-item">
          <img *ngIf="getProductImage(item.productId) as imageUrl" 
            [src]="imageUrl" 
            [alt]="item.productTitle"
            class="item-image"
            onerror="this.style.display='none'; this.nextElementSibling?.classList.remove('hidden')" />
          <div *ngIf="!getProductImage(item.productId)" class="item-image-placeholder hidden">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
              <circle cx="9" cy="9" r="2"></circle>
              <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
            </svg>
          </div>
          <div class="item-details">
            <p class="item-name">{{ item.productTitle }}</p>
            <p class="item-quantity">Quantity: {{ item.quantity }}</p>
            <p class="item-price">${{ (item.price * item.quantity).toFixed(2) }}</p>
          </div>
        </div>
        }
      </div>

      <div class="divider"></div>

      <div class="shipping-address-box">
        <h3 class="address-title">Shipping Address</h3>
        <div class="address-details">
          <p>{{ order.shippingAddress.fullName }}</p>
          <p>{{ order.shippingAddress.address }}</p>
          <p>{{ order.shippingAddress.city }}, {{ order.shippingAddress.country }}</p>
          <p>{{ order.shippingAddress.phone }}</p>
        </div>
      </div>

      <div class="divider"></div>

      <div class="order-total">
        <span class="total-label">Total</span>
        <span class="total-amount">${{ order.totalPrice.toFixed(2) }}</span>
      </div>
    </div>

    } @empty {
    <div class="empty-state">
      <p class="empty-text">No orders found for your account.</p>
    </div>
    }
  </div>
</div>