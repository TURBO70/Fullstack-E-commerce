<div class="mx-16 my-4 p-8 rounded-2xl border bg-white border-border">
    <div class="flex justify-between items-center bg-white">
        <h1 class="text-2xl font-semibold">Products</h1>
        <button (click)="openAddModal()"
            class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 bg-primary text-primary-foreground hover:bg-primary/90 hover:cursor-pointer h-10 px-4 py-2 gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-plus h-4 w-4">
                <path d="M5 12h14"></path>
                <path d="M12 5v14"></path>
            </svg>
            Add Product
        </button>
    </div>
    <div class="overflow-x-auto my-4 rounded-xl shadow-sm">
        <table class="w-full border-collapse">
            <thead class="">
                <tr class="border-b border-border text-muted-foreground text-sm font-extralight">
                    <th class="text-left py-4 px-4">Image</th>
                    <th class="text-left py-4 px-4">Name</th>
                    <th class="text-left py-4 px-4">Category</th>
                    <th class="text-left py-4 px-4">Price</th>
                    <th class="text-left py-4 px-4">Stock</th>
                    <th class="text-left py-4 px-4">Actions</th>
                </tr>
            </thead>

            <tbody class="text-sm">
                <!-- ROW -->
                @for (product of productsWithCategory(); track $index) {
                <tr class="border-b border-gray-200 hover:bg-gray-50 transition">
                    <td class="py-4 px-4">
                        <img [src]="product.image" alt="product picture" class="w-10 h-10 rounded-lg object-cover" />
                    </td>

                    <td class="py-4 px-4 font-medium text-gray-800">
                        @if(product.id === editedProduct?.id) {
                        <input type="text" [(ngModel)]="product.name"
                            class="border border-gray-300 rounded-md px-2 py-1 w-full" />
                        } @else {
                        {{ product.name }}
                        }
                    </td>

                    <td class="py-4 px-4 text-gray-600">
                        @if(product.id === editedProduct?.id) {
                        <input type="text" [(ngModel)]="product.categoryName"
                            class="border border-gray-300 rounded-md px-2 py-1 w-full" />
                        } @else {
                        {{ product.categoryName }}
                        }
                    </td>

                    <td class="py-4 px-4 text-gray-800">
                        @if(product.id === editedProduct?.id) {
                        <input type="number" [(ngModel)]="product.price"
                            class="border border-gray-300 rounded-md px-2 py-1 w-full" />
                        } @else {
                        ${{ product.price }}
                        }
                    </td>

                    <td class="py-4 px-4 text-gray-800">
                        @if(product.id === editedProduct?.id) {
                        <input type="number" [(ngModel)]="product.stock"
                            class="border border-gray-300 rounded-md px-2 py-1 w-full" />
                        } @else {
                        {{ product.stock }}
                        }
                    </td>

                    <td class="py-4 px-4">
                        <div class="flex items-center gap-4">
                            @if(product.id === editedProduct?.id) {
                            <!-- Save -->
                            <button id="saveBtn" (click)="saveProduct(product)"
                                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground hover:cursor-pointer h-10 w-10 text-success">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-check h-4 w-4">
                                    <path d="M20 6 9 17l-5-5"></path>
                                </svg>
                            </button>
                            }@else if(product.id === deletedProduct?.id){
                            <!-- delete -->
                            <button id="deleteBtn" (click)="fireDeleteProduct(product)"
                                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground hover:cursor-pointer h-10 w-10 text-success">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-check h-4 w-4">
                                    <path d="M20 6 9 17l-5-5"></path>
                                </svg>
                            </button>
                            }

                            @else {
                            <!-- Edit -->
                            <button id="editBtn" (click)="editProduct(product)"
                                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground hover:cursor-pointer h-10 w-10">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-pencil h-4 w-4">
                                    <path
                                        d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z">
                                    </path>
                                    <path d="m15 5 4 4"></path>
                                </svg>
                            </button>
                            }

                            @if(product.id === editedProduct?.id || product.id === deletedProduct?.id) {
                            <!-- Cancel -->
                            <button id="cancelBtn" (click)="cancelEdit()"
                                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground hover:cursor-pointer h-10 w-10 text-muted-foreground">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-x h-4 w-4">
                                    <line x1="18" x2="6" y1="6" y2="18"></line>
                                    <line x1="6" x2="18" y1="6" y2="18"></line>
                                </svg>
                            </button>
                            }
                            @else {
                            <!-- Delete -->
                            <button id="deleteBtn" (click)="deleteProduct(product)"
                                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground hover:cursor-pointer h-10 w-10 text-destructive">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-trash2 h-4 w-4">
                                    <path d="M3 6h18"></path>
                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                    <line x1="10" x2="10" y1="11" y2="17"></line>
                                    <line x1="14" x2="14" y1="11" y2="17"></line>
                                </svg>
                            </button>
                            }
                        </div>
                    </td>
                </tr>
                }

            </tbody>
        </table>
    </div>
</div>

<app-add-product-modal [open]="showModal" [product]="selectedProduct" (close)="closeModal()"
    (save)="handleSave($event)">
</app-add-product-modal>